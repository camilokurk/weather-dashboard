<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Wheather Dashboard</title>
</head>
<body>
    <h1>Dashboard del Clima</h1>
    
    <input id="city" type="text" placeholder="Ciudad" value="Buenos Aires">

    <div id="suggestions" style="border:1px solid #ccc; max-width:200px;"></div>

    <button id="load-weather">Cargar Clima</button>

    <p id="temperature">Temperatura: -- °C</p>

    <script>
        const button = document.getElementById("load-weather");
        const tempText = document.getElementById("temperature");
        const cityInput = document.getElementById("city");
        const suggestions = document.getElementById("suggestions");

        button.addEventListener("click", () => {
            const city = cityInput.value;

            fetch(`/weather?city=${encodeURIComponent(city)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        tempText.textContent = data.error;
                        return;
                    }

                    const temp = data.current_weather.temperature;
                    tempText.textContent = `Temperatura en ${city}: ${temp} °C`;
                })
                .catch(error => {
                    console.error(error);
                    tempText.textContent = "Error al cargar el clima.";
                });
        });

        cityInput.addEventListener("input", () => {
            const query = cityInput.value;
            if (!query) {
                suggestions.innerHTML = "";
                return;
            }

            fetch(`/autocomplete?query=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    suggestions.innerHTML = "";
                    data.forEach(option => {
                        const div = document.createElement("div");
                        div.textContent = option;
                        div.style.cursor = "pointer";
                        div.addEventListener("click", () => {
                            cityInput.value = option.split(",")[0];
                            suggestions.innerHTML = "";
                        });
                        suggestions.appendChild(div);
                    });
                })
                .catch(error => {
                    console.error(error);
                });
            
        });
    </script>

</body>
</html>