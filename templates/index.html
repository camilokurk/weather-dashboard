<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Wheather Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="app">
        <h1>Weather Dashboard</h1>

        <div class="search">
            <div class="input-wrapper">
                <input id="city" type="text" placeholder="Ciudad">
                <div id="suggestions" class="suggestions"></div>
            </div>
            <button id="load-weather">Buscar</button>
        </div>

        <p id="temperature" class="result">
            Ingrese una ciudad para ver el clima.
        </p>
    </div>

    <script>
        const button = document.getElementById("load-weather");
        const tempText = document.getElementById("temperature");
        const cityInput = document.getElementById("city");
        const suggestions = document.getElementById("suggestions");

        button.addEventListener("click", () => {
            const city = cityInput.value;

            fetch(`/weather?city=${encodeURIComponent(city)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        tempText.textContent = data.error;
                        return;
                    }

                    const temp = data.current_weather.temperature;
                    tempText.textContent = `Temperatura en ${city}: ${temp} Â°C`;
                })
                .catch(error => {
                    console.error(error);
                    tempText.textContent = "Error al cargar el clima.";
                });
        });

        const suggestionsBox = document.getElementById("suggestions");
        const inputWrapper = document.querySelector(".input-wrapper");

        cityInput.addEventListener("input", () => {
            const query = cityInput.value;

            if (query.length < 2) {
                suggestionsBox.innerHTML = "";
                inputWrapper.classList.remove("active");
                return;
            }

            fetch(`/cities?q=${encodeURIComponent(query)}`)
                .then(res => res.json())
                .then(cities => {
                    suggestionsBox.innerHTML = "";
                    if (cities.length === 0) {
                        inputWrapper.classList.remove("active");
                        return;
                    }

                    cities.forEach(city => {
                        const div = document.createElement("div");
                        div.className = "suggestion";
                        div.textContent = `${city.name}, ${city.country}`;

                        div.addEventListener("click", () => {
                            cityInput.value = city.name;
                            suggestionsBox.innerHTML = "";
                            inputWrapper.classList.remove("active");
                        });

                        suggestionsBox.appendChild(div);
                    });

                    inputWrapper.classList.add("active");
                });
        });

// ocultar al presionar Enter
cityInput.addEventListener("keydown", (event) => {
    if (event.key === "Enter") {
        button.click();
        suggestionsBox.innerHTML = "";
        inputWrapper.classList.remove("active");
    }
});

// ocultar al perder foco
cityInput.addEventListener("blur", () => {
    setTimeout(() => { // timeout para que el click en la sugerencia funcione
        suggestionsBox.innerHTML = "";
        inputWrapper.classList.remove("active");
    }, 100);
});


        cityInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                button.click();
            }
        });
    </script>

</body>
</html>